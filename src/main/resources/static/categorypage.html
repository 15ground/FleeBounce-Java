<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Insert title here</title>
</head>

<body>
    <form id="searchForm">
        Tên : <input name="name" type="text">
        <input type="hidden" name="page" value="0"> Xếp theo:
        <select name="sortBy">
			<option value="id">Id</option>
			<option value="name">Tên</option>
		</select> Thứ tự :
        <select name="index">
			<option value="true">Tăng dần</option>
			<option value="false">Giảm dần</option>
		</select>
        <button type="button" id="bSearch">Tìm kiếm</button>
    </form>
    <table>
        <thead>
            <tr>
                <th>id</th>
                <th>Tên</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody id="categories">
        </tbody>
    </table>
    <div id="paging">
    </div>

    <script src="https://cdn.jsdelivr.net/npm/handlebars@latest/dist/handlebars.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
    <script src="https://brainfoolong.github.io/form-data-json/lib/form-data-json.min.js"></script>
    <script type="text/javascript">
        var rowTemplate = "{{#each categories}}" +
            "<tr>" +
            '<td>{{id}}</td>' +
            '<td>{{name}}</td>' +
            '<td><button class="edit" c-id="{{id}}">Edit</td>' +
            '<td><button class="delete" c-id="{{id}}">Delete</td>' +
            "</tr>" +
            "{{/each}}";
        var rowHbs = Handlebars.compile(rowTemplate);

        function loadList() {
            var searchForm = FormDataJson.formToJson(document.querySelector("form"));
            var searchOption = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(searchForm)
            };


            fetch("/api/category/search", searchOption).then(res => res.json())
                .then(data => {
                    var rows = rowHbs({
                        categories: data.content
                    });
                    $("#categories").html(rows);

                    var pageHtml = "";
                    for (var i = 0; i < data.totalPages; i++) {
                        pageHtml += `<button value="${i}" class="page-link pageIndex">${i+1}</button>`;
                    }
                    $("#paging").html(pageHtml);

                    $(".pageIndex").click(function() {
                        $('#searchForm input[name="page"]').val($(this).val());
                        loadList();
                    });
                });
        }
        loadList();

        $("#bSearch").click(function() {
            loadList();
        });
    </script>
</body>

</html>